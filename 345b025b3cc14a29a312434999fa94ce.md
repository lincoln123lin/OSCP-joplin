id: 345b025b3cc14a29a312434999fa94ce
parent_id: 
item_type: 1
item_id: c945d5b6762b46c488bac2b2cfaead54
item_updated_time: 1642414405471
title_diff: "[{\"diffs\":[[1,\"Active (AD)\"]],\"start1\":0,\"start2\":0,\"length1\":0,\"length2\":11}]"
body_diff: "[{\"diffs\":[[1,\"## Nmap results\\\n\\\n![93bb559312f61772ef42ab9f65ff0b2b.png](:/6be537027412478c9eaee1d50c8277a0)\\\n\\\nNoted DNS is open - 7601 - win 7 \\\\[nmap will identify\\\\]\\\n\\\n9000 range = windows 2012 or win 10\\\n\\\nAbove 9000 = Windows server 2016\\\n\\\nLDAP giving its host domain name as active.htb ==> Edit host file /etc/hosts\\\n\\\n![eaac6e8ddd3d757ee16e5264e0d20725.png](:/c320536e3c9a40f8a453943cd6d636fa)\\\n\\\nNoted the time of the kerberos - make sure the timing is within a minute of the timing\\\n\\\nSMB is open - but no shares are listed - ought to have some anonymous shares;\\\n\\\n## <ins>Now figure out the hostname based on the domain name</ins>\\\n\\\nNslookup did not work\\\n\\\n![35004d42b778d441bcf587079fb9b77d.png](:/288c54c54b2e4dd5a1ff89498be8b376)\\\n\\\nDNSRecon ==> run it within the subnet mask and let it run while doing other things\\\n\\\n![feb08372ffd06e8a614a000c1a8342e0.png](:/6d54be1ffa484af7be0bd7ea5f017c34)\\\n\\\n## Poke at SMB\\\n\\\nFind scripts for SMB --> decided to use safe scripts on port 445\\\n\\\n![cb19dde2c5f9f4dbe27f964fcb7dbbac.png](:/781498b3573c483986328c5503356fdd)![83e57aecfcfce7e701a6a02a4f219a7e.png](:/c429e37c834c439cb4aaa57e0037ae8d)![5f2639d74ee77d0b1eeac4c73376aaa5.png](:/f688197e36d6415f8ffceb761b8a5eb0)\\\n\\\nScripts mention that SMBv2 is required, nothing else\\\n\\\nUse smbclient to do a connection (anonymous)\\\n\\\n> smbclient -L [//10.10.10.100](//10.10.10.100)\\\n\\\n![daad200f3ef681fdc2ae00d6484b2981.png](:/2dbcffc614164a18912f6990298dbafe)\\\n\\\nRan enum4linux but said that most of the time it will give errors or timeouts; not so good\\\n\\\nused smbmap instead\\\n\\\n> smbmap -H 10.10.10.100\\\n\\\n![faf29913251dde04313c5518f1005af6.png](:/05f06f5f70e047ba8d4a7194cf5e8974)\\\n\\\nWe can use the enumeration of files option to get what is inside the Replication Directory\\\n\\\n> smbmap -R Replication -H 10.10.10.100\\\n\\\n![22e641214a6956c11cc06ddc12d4e814.png](:/0c7aaa46721e4d9d8625947a31660cf6)\\\n\\\nWill be able to see Groups.xml ==> Group policy file (Before 2012); LAPSE now\\\n\\\nDownload the file\\\n\\\n> smbmap -R Replication -H 10.10.10.100 -A Groups.xml -q\\\n\\\n![51241197abd6caa9d1fa3ea7c2fb54c5.png](:/f18b90bf69a84fa1bdaa52821e564a1b)\\\n\\\ndo the following commands to find the downloaded file\\\n\\\n> updatedb\\\n> \\\n> locate Groups.xml\\\n\\\n![1c55fea3488be3f2be7b347eb9ca9b6f.png](:/09983072765f4349aed54c12259db51e)\\\n\\\nLook into the file, and find the username and encrypted password\\\n\\\n![b2cd8a384d76ec6575b2f3aa0ce4b4b5.png](:/9f891f873e0545b7929d5315c5080e3a)\\\n\\\nUse gpp-decrypt to get the password of the hash\\\n\\\n![3118c4a40c88e9fd6520f7a88f0ab4b8.png](:/e8e4cbc8b5a044d6a979f25697a15405)\\\n\\\nFor documentation purposes, store the credentials in creds.txt - svc_tgs:GPPstillStandingStrong2k18\\\n\\\nAlternative approach recommended: use \\\\*\\\\*smbclient, recurse ON; prompt OFF; mget \\\\* ==>**download everything\\\n\\\n## Use Impacket GetADUsers after getting credential\\\n\\\nUsed GetADUsers to test the credentials\\\n\\\n![6d9a4d3143d639f063a103743c7a51eb.png](:/ed9da2fdee1747db9a3557a669168c59)\\\n\\\nuse psexec to get execution\\\n\\\n![8f58ff55fd719c51b10fbae8096a81cf.png](:/2918322db0014279959d9e3b3a016fcf)\\\n\\\nCommand fails as there is no writable shared directory\\\n\\\nUse smbmap to authenticate into the server and get more file shares\\\n\\\n![2d40c1a8c7504223055a8d0799dbee13.png](:/e5a167e8a21f4f4a8053e0f6f26f5574)\\\n\\\nEnumerate the files in Users and see if there is anything useful ==> found user.txt file\\\n\\\n![ce047b8076a2d92eda4d60977e606d3a.png](:/34a88a12d48a43dd8098e5d05ec09f81)\\\n\\\nasdasd\\\n\\\n## Use BloodHound on Windows\\\n\\\nWindows used as it is easier;\\\n\\\nOpen prompt and use \\\"runas /netonly\\\" to create a session that doesn't validate the user against the local box ==> put the user credential into the session\\\n\\\n![5b3fdce290af74e59add0510561ffd63.png](:/f9fe430c04144d76add531d9d3b208e8)\\\n\\\nverify against the server by attempting to read the directory using 'dir'\\\n\\\n![ea87e6215ea95aa0e609f13817c8e47c.png](:/9afdade048ac4f71898c80c134a8b44c)\\\n\\\nDownload the (previously setup) Bloodhound's Sharphound in Ingest folder into the windows\\\n\\\n![61d26a81f88214100fed35c7fdcfc092.png](:/ee7310c53d964e18b7fb3fcf13b1127c)\\\n\\\nOnce done, call the command\\\n\\\n> .\\\\\\\\SharpHound.exe -c all -d active.htb --domaincontroller 10.10.10.100\\\n\\\n![9884c6c6c272a35a92041456fca7e4e1.png](:/99a1ba36af3645a8a80c5c43aaa8f4d2)\\\n\\\nWhat we get is a failure ==> Test the connection on port 389 (LDAP) to check if reachable; and it is true\\\n\\\nTry the command again, but use wireshark to monitor packets ===> There were no packets sent; nothing happen\\\n\\\nConfigured the DNS Server under the control panel --> Network Adapters to point to 10.10.10.100, as the server in communication is with the network's DNS\\\n\\\n![679b861fd45b2dcd9b408419f5c209ff.png](:/a2e3edbb667945f4bf57845d13d18fed)\\\n\\\nThis should work although it takes very slow; You will obtain a zip file\\\n\\\n![0f9c83304d4ad40249b704b761dd54cf.png](:/8ad00a01eb4b4df0bd2ff9302922a17f)![9caff79885fe3724b01a4b86d9701570.png](:/66946d85f39b410aaad8a08a8b00376d)\\\n\\\nTransfer the zip file back to Kali, and use bloodhound there\\\n\\\n## Use BloodHound on Linux for analysis\\\n\\\n> neo4j start\\\n> \\\n> ./Bloodhound\\\n\\\nDrag and drop the zipfile into bloodhound; Then start to do queries on the data regarding obtaining Kerberoastable users\\\n\\\n![f77d7c5d6c57c76b42e400a0bb08dd06.png](:/955824c2734b4dd38fd08db00d338116)\\\n\\\nWe obtain that the administrator is kerberoastable; Proceed to use Get-SPNUsers\\\n\\\n## Use Impacket to get the password Hash\\\n\\\n> GetUserSPN.py -request -dc-ip 10.10.10.100 active.htb/svc_tgs\\\n\\\n![c9d4ff33295011736fdfe21aeeb8e864.png](:/28ae120da66e4403bbb2a4614d180a4a)\\\n\\\nWe obtain the kerberoasable hash data of the administrator\\\n\\\n## Use HashCat to crack the Hash\\\n\\\nGo to hashcat example hashes, and find kbtgs$23 formatting to use\\\n\\\n![14fad8a0b99140a7f366c0d07183c012.png](:/0e369e16317845c59699228f107c7828)\\\n\\\n> hashcat -m 13100 hashes/active.htb /opt/wordlist/rockyou.txt\\\n\\\n![d6e54f10d57386c30db3b8c318f282b3.png](:/dc6e1a9341f1404aa858efee6222ea31)\\\n\\\nThe password is obtained ==> test the password with psexec\\\n\\\n> psexec.py active.htb/Administrator@10.10.10.100\\\n\\\n![dd1665ccde16b936a6890e46ebd1a693.png](:/61ad08857f804a38acca37ad29035712)\\\n\\\nRoot is obtained\"]],\"start1\":0,\"start2\":0,\"length1\":0,\"length2\":6020}]"
metadata_diff: {"new":{"id":"c945d5b6762b46c488bac2b2cfaead54","parent_id":"3305ced1fb6949afa3e15d5355c1c230","latitude":"0.00000000","longitude":"0.00000000","altitude":"0.0000","author":"","source_url":"","is_todo":0,"todo_due":0,"todo_completed":0,"source":"joplin-desktop","source_application":"net.cozic.joplin-desktop","application_data":"","order":0,"markup_language":1,"is_shared":0,"share_id":"","conflict_original_id":"","master_key_id":""},"deleted":[]}
encryption_cipher_text: 
encryption_applied: 0
updated_time: 2022-02-28T02:44:25.861Z
created_time: 2022-02-28T02:44:25.861Z
type_: 13